import{r as g,S as Q,i as X,j as e,f as c,k as q}from"./index-CJy4qUNt.js";import{u as K,S as Z,I as y}from"./Layout-D7aCIW-g.js";import{T as ee,C as se,S as ae}from"./BulkActionDrawer-Ilht11mX.js";import{T as $,D as ne,u as te,M as le}from"./DrawerButton-t2wjd4RF.js";import{D as re,E as ie}from"./EditDeleteButton-DegEB00X.js";import{T as de}from"./ParentCategory-BA8hJzT_.js";import{n as _,a as k}from"./toast-Cy6Kz85v.js";import{u as oe,E as z}from"./index.esm-DnZxAGHy.js";import{I as me}from"./InputArea-BEP-eM_i.js";import{L}from"./LabelArea-DhnlBOFv.js";import{S as pe}from"./SwitchToggle-BkQetNrW.js";import{U as ce}from"./Uploader-BHwjysaW.js";import{C as B}from"./ProductServices-BJb6WztP.js";import{u as xe}from"./useTranslationValue-0vcdxz2h.js";const ue=(d,m)=>{const{isDrawerOpen:t,closeDrawer:f,setIsUpdate:x,lang:I}=g.useContext(Q),[o,C]=g.useState({}),[S,T]=g.useState(""),[D,u]=g.useState(""),[A,s]=g.useState([]),[l,b]=g.useState("en"),[p,w]=g.useState(!0),[E,U]=g.useState(""),[H,v]=g.useState(!1),{handlerTextTranslateHandler:P}=xe(),{register:a,handleSubmit:h,setValue:n,clearErrors:r,reset:F,formState:{errors:W}}=oe(),Y=async({name:j,description:i})=>{var M,R;try{v(!0);const N=await P(j,l,o==null?void 0:o.name),J=await P(i,l,o==null?void 0:o.description),V={name:{...N,[l]:j},description:{...J,[l]:i||""},parentId:S||void 0,parentName:E||"Home",icon:D,status:p?"show":"hide",lang:l};if(d){const O=await B.updateCategory(d,V);x(!0),v(!1),k(O.message),f(),F()}else{const O=await B.addCategory(V);x(!0),v(!1),k(O.message),f()}}catch(N){v(!1),_(N?(R=(M=N==null?void 0:N.response)==null?void 0:M.data)==null?void 0:R.message:N==null?void 0:N.message),f()}},G=j=>{b(j),Object.keys(o).length>0&&(n("name",o.name[j||"en"]),n("description",o.description[j||"en"]))};return g.useEffect(()=>{var j;if(!t){C({}),n("name"),n("parentId"),n("parentName"),n("description"),n("icon"),u(""),w(!0),r("name"),r("parentId"),r("parentName"),r("description"),U("Home"),b(I),n("language",l),m!==void 0&&((j=m[0])==null?void 0:j._id)!==void 0&&T(m[0]._id);return}d&&(async()=>{try{const i=await B.getCategoryById(d);i&&(C(i),n("name",i.name[l||"en"]),n("description",i.description[l||"en"]),n("language",l),n("parentId",i.parentId),n("parentName",i.parentName),U(i.parentName),T(i.parentId),u(i.icon),w(i.status==="show"))}catch(i){_(i?i.response.data.message:i.message)}})()},[d,n,t,l,r,m,I]),{register:a,handleSubmit:h,onSubmit:Y,errors:W,imageUrl:D,setImageUrl:u,children:A,setChildren:s,published:p,setPublished:w,checked:S,setChecked:T,isSubmitting:H,selectCategoryName:E,setSelectCategoryName:U,handleSelectLanguage:G}},he=({id:d,data:m})=>{const{t}=X();console.log(m);const{checked:f,register:x,onSubmit:I,handleSubmit:o,errors:C,imageUrl:S,setImageUrl:T,published:D,setPublished:u,setChecked:A,selectCategoryName:s,setSelectCategoryName:l,handleSelectLanguage:b,isSubmitting:p}=ue(d,m),{showingTranslateValue:w}=K(),E=`
  .rc-tree-child-tree {
    display: hidden;
  }
  .node-motion {
    transition: all .3s;
    overflow-y: hidden;
  }
`,U={motionName:"node-motion",motionAppear:!1,onAppearStart:a=>({height:0}),onAppearActive:a=>({height:a.scrollHeight}),onLeaveStart:a=>({height:a.offsetHeight}),onLeaveActive:()=>({height:0})},H=a=>{var n;let h=[];for(let r of a)h.push({title:w(r.name),key:r._id,children:((n=r==null?void 0:r.children)==null?void 0:n.length)>0&&H(r.children)});return h},v=(a,h)=>{var n;return a._id===h?a:(n=a==null?void 0:a.children)==null?void 0:n.reduce((r,F)=>r??v(F,h),void 0)},P=async a=>{if(a!==void 0)if(d){const h=await B.getCategoryById(a);if(d===a)return _("This can't be select as a parent category!");if(d===h.parentId)return _("This can't be select as a parent category!");{if(a===void 0)return;A(a);const n=m[0],r=v(n,a);l(w(r==null?void 0:r.name))}}else{if(a===void 0)return;A(a);const h=m[0],n=v(h,a);l(w(n==null?void 0:n.name))}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:d?e.jsx($,{register:x,handleSelectLanguage:b,title:t("UpdateCategory"),description:t("UpdateCategoryDescription")}):e.jsx($,{register:x,handleSelectLanguage:b,title:t("AddCategoryTitle"),description:t("AddCategoryDescription")})}),e.jsx(Z,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:o(I),children:[e.jsxs("div",{className:"p-6 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:t("Name")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(me,{required:!0,register:x,label:"Category title",name:"name",type:"text",placeholder:t("ParentCategoryPlaceholder")}),e.jsx(z,{errorName:C.name})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:t("Description")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(ee,{register:x,label:"Description",name:"description",type:"text",placeholder:"Category Description"}),e.jsx(z,{errorName:C.description})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:t("ParentCategory")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4 relative",children:[e.jsx(c.Input,{readOnly:!0,...x("parent",{required:!1}),name:"parent",value:s||"Home",placeholder:t("ParentCategory"),type:"text"}),e.jsxs("div",{className:"draggable-demo capitalize",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:E}}),e.jsx(de,{expandAction:"click",treeData:H(m),selectedKeys:[f],onSelect:a=>P(a[0]),motion:U,animation:"slide-up"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:t("CategoryIcon")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(ce,{imageUrl:S,setImageUrl:T,folder:"category",targetWidth:238,targetHeight:238})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:t("Published")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(pe,{handleProcess:u,processOption:D})})]})]}),e.jsx(ne,{id:d,title:"Category",isSubmitting:p})]})})]})},Ue=({data:d,lang:m,isCheck:t,categories:f,setIsCheck:x,useParamId:I,showChild:o})=>{const{title:C,serviceId:S,handleModalOpen:T,handleUpdate:D}=te(),{showingTranslateValue:u}=K(),A=s=>{const{id:l,checked:b}=s.target;x([...t,l]),b||x(t.filter(p=>p!==l))};return console.log(f),e.jsxs(e.Fragment,{children:[(t==null?void 0:t.length)<1&&e.jsx(re,{useParamId:I,id:S,title:C}),e.jsx(le,{children:e.jsx(he,{id:S,data:d,lang:m})}),e.jsx(c.TableBody,{children:f==null?void 0:f.map(s=>{var l,b;return e.jsxs(c.TableRow,{children:[e.jsx(c.TableCell,{children:e.jsx(se,{type:"checkbox",name:"category",id:s==null?void 0:s.id,handleClick:A,isChecked:t==null?void 0:t.includes(s==null?void 0:s.id)})}),e.jsx(c.TableCell,{className:"font-semibold uppercase text-xs"}),e.jsx(c.TableCell,{children:s!=null&&s.icon?e.jsx(c.Avatar,{className:"hidden mr-3 md:block bg-gray-50 p-1",src:s==null?void 0:s.icon,alt:s==null?void 0:s.parent}):e.jsx(c.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product",className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none"})}),e.jsx(c.TableCell,{className:"font-medium text-sm ",children:((l=s==null?void 0:s.children)==null?void 0:l.length)>0?e.jsxs(q,{to:`/categories/${s==null?void 0:s.id}`,className:"text-blue-700",children:[u(s==null?void 0:s.name),e.jsx(e.Fragment,{children:o&&e.jsxs(e.Fragment,{children:[" ",e.jsx("div",{className:"pl-2 ",children:(b=s==null?void 0:s.children)==null?void 0:b.map(p=>e.jsx("div",{children:e.jsx(q,{to:`/categories/${p==null?void 0:p.id}`,className:"text-blue-700",children:e.jsxs("div",{className:"flex text-xs items-center  text-blue-800",children:[e.jsx("span",{className:" text-xs text-gray-500 pr-1",children:e.jsx(y,{})}),e.jsx("span",{className:"text-gray-500",children:u(p.name)})]})})},p.id))})]})})]}):e.jsx("span",{children:u(s==null?void 0:s.name)})}),e.jsx(c.TableCell,{className:"text-sm",children:u(s==null?void 0:s.description)}),e.jsx(c.TableCell,{className:"text-center",children:e.jsx(ae,{id:s==null?void 0:s.id,category:!0,status:s.status})}),e.jsx(c.TableCell,{children:e.jsx(ie,{id:s==null?void 0:s.id,parent:s,isCheck:t,children:s==null?void 0:s.children,handleUpdate:D,handleModalOpen:T,title:u(s==null?void 0:s.name)})})]},s==null?void 0:s.id)})})]})};export{he as C,Ue as a};
